<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <title>Klasifikasi Apel Fuji</title>
    <link
      rel="icon"
      href="{{ url_for('static', filename='images/favicon.png') }}"
    />
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='style.css') }}"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      .fade-in {
        animation: fadeIn 1.2s ease;
      }
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(40px);
        }
        to {
          opacity: 1;
          transform: none;
        }
      }
      .img-preview {
        display: block;
        max-width: 220px;
        width: 100%;
        margin: 18px auto 0;
        border-radius: 12px;
        box-shadow: 0 2px 10px rgba(200, 40, 60, 0.1);
        transition: transform 0.5s cubic-bezier(0.4, 2, 0.3, 1);
      }
      .img-preview.hide {
        display: none;
      }
      .result-anim {
        animation: slideUp 0.8s cubic-bezier(0.4, 2, 0.3, 1);
      }
      @keyframes slideUp {
        from {
          opacity: 0;
          transform: translateY(40px);
        }
        to {
          opacity: 1;
          transform: none;
        }
      }
      .btn-animate {
        transition: transform 0.2s;
      }
      .btn-animate:active {
        transform: scale(0.96);
      }
      .custom-file-input {
        position: relative;
        display: flex;
        justify-content: center;
        align-items: center;
        width: 100%;
        max-width: 340px;
        margin: 0 auto 18px auto;
        height: 48px;
      }
      .custom-file-input input[type="file"] {
        opacity: 0;
        width: 100%;
        height: 100%;
        position: absolute;
        left: 0;
        top: 0;
        cursor: pointer;
      }
      .file-label {
        width: 100%;
        display: flex;
        align-items: center;
        justify-content: flex-start;
        background: #f3f3f3;
        color: #666;
        font-weight: 600;
        border-radius: 24px;
        padding: 12px 24px;
        font-size: 1em;
        box-shadow: 0 2px 8px rgba(180, 180, 180, 0.06);
        cursor: pointer;
        transition: background 0.2s, box-shadow 0.2s;
        border: 1.5px solid #e0e0e0;
        min-height: 48px;
      }
      .file-label:hover {
        background: #e9ecef;
        box-shadow: 0 4px 16px rgba(180, 180, 180, 0.1);
      }
      .file-name {
        margin-left: 16px;
        color: #888;
        font-size: 0.98em;
        font-weight: 500;
        max-width: 180px;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
      }
      .hasil-box {
        margin-top: 32px;
        background: #f7f7fa;
        border-radius: 18px;
        padding: 22px 18px 18px 18px;
        box-shadow: 0 2px 10px rgba(67, 206, 162, 0.07);
        text-align: center;
        max-width: 340px;
        margin-left: auto;
        margin-right: auto;
      }
      .hasil-title {
        font-weight: 700;
        color: #185a9d;
        font-size: 1.1em;
        margin-bottom: 8px;
        letter-spacing: 1px;
      }
      .hasil-value {
        font-size: 1.3em;
        font-weight: 700;
        margin-bottom: 8px;
        color: #2a9d8f;
        text-transform: uppercase;
      }
      .hasil-desc {
        font-size: 1em;
        color: #444;
        font-weight: 500;
      }
      @media (max-width: 600px) {
        .container {
          padding: 18px 6vw !important;
        }
        .img-preview {
          max-width: 98vw;
        }
        .hasil-box {
          padding: 16px 6vw 14px 6vw;
        }
        .custom-file-input,
        .btn-success,
        .btn-blue {
          max-width: 100vw;
        }
      }
    </style>
  </head>
  <body>
    <div class="gradient-background fade-in">
      <div
        class="container"
        style="max-width: 500px; background: rgba(255, 255, 255, 0.96)"
      >
        <div class="header-title" style="font-size: 1.5em">
          Klasifikasi Kematangan Apel Fuji
        </div>
        <hr />
        <form
          action="/klasifikasi"
          method="post"
          enctype="multipart/form-data"
          style="text-align: center; margin-top: 20px"
        >
          <div class="custom-file-input">
            <label class="file-label" for="file-input">
              Pilih Gambar Apel
              <span class="file-name" id="file-name">Belum ada file</span>
            </label>
            <input
              type="file"
              name="file"
              id="file-input"
              accept="image/*"
              required
            />
          </div>
          <img id="img-preview" class="img-preview hide" alt="Preview Gambar" />
          <button
            type="submit"
            class="btn-success btn-animate"
            id="klasifikasi-btn"
            style="margin-top: 18px"
          >
            KLASIFIKASI
          </button>
        </form>
        {% if result %}
        <div class="hasil-box result-anim">
          <div class="hasil-title">Hasil:</div>
          <div class="hasil-value">{{ result }}</div>
          <div class="hasil-desc">
            {% if result == 'Matang' %} Apel Fuji-mu sudah matang sempurna, siap
            disantap! üçé {% elif result == 'Setengah Matang' %} Apel Fuji-mu
            setengah matang, rasanya segar dan sedikit renyah! {% elif result ==
            'Mentah' %} Apel Fuji-mu masih mentah, simpan dulu agar makin manis!
            {% else %} Hasil klasifikasi tidak dikenali. {% endif %}
          </div>
        </div>
        {% elif result is not none %}
        <div
          class="message error result-anim"
          style="display: block; margin-top: 30px"
        >
          {{ result }}
        </div>
        {% endif %}
        <button onclick="window.location.href='/'" class="btn-blue btn-animate">
          ‚Üê KEMBALI
        </button>
      </div>
    </div>
    <script>
      // Animasi preview gambar & tampilkan nama file
      const fileInput = document.getElementById("file-input");
      const imgPreview = document.getElementById("img-preview");
      const fileName = document.getElementById("file-name");
      // Tampilkan preview jika sudah ada file (untuk reload setelah submit)
      {% if request.method == 'POST' and file %}
        imgPreview.src = "{{ url_for('static', filename='uploads/' + file.filename) }}";
        imgPreview.classList.remove("hide");
      {% endif %}
      fileInput.addEventListener("change", function (e) {
        if (this.files && this.files[0]) {
          const reader = new FileReader();
          reader.onload = function (ev) {
            imgPreview.src = ev.target.result;
            imgPreview.classList.remove("hide");
          };
          reader.readAsDataURL(this.files[0]);
          fileName.textContent = this.files[0].name;
        } else {
          imgPreview.classList.add("hide");
          imgPreview.src = "";
          fileName.textContent = "Belum ada file";
        }
      });

      // Animasi tombol saat submit
      const form = document.querySelector("form");
      const btn = document.getElementById("klasifikasi-btn");
      form.addEventListener("submit", function () {
        btn.innerHTML =
          '<span style="display:inline-block;vertical-align:middle;"><svg width="22" height="22" viewBox="0 0 50 50"><circle cx="25" cy="25" r="20" fill="none" stroke="#fff" stroke-width="5" stroke-linecap="round" stroke-dasharray="31.4 31.4" transform="rotate(-90 25 25)"><animateTransform attributeName="transform" type="rotate" from="0 25 25" to="360 25 25" dur="1s" repeatCount="indefinite"/></circle></svg></span> Memproses...';
        btn.disabled = true;
      });
    </script>
  </body>
</html>
